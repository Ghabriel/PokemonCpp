<h2>Adding moves</h2>

<p>The main file that tells the game which moves exist and what they do is <strong>moves.json</strong>. An example content is illustrated below.</p>
<code>{
    "Tackle": {
        "display-name": "Tackle",
        "type": "Normal",
        "kind": "Physical",
        "function-code": 0,
        "function-parameter": 0,
        "power": 40,
        "accuracy": 100,
        "pp": 35,
        "effect-rate": 0,
        "target-type": "single-target",
        "priority": 0,
        "flags": "abef",
        "description": "A physical attack in which the user charges and slams into the target with its whole body."
    }
}
</code>

<p id="move-fields">A move definition has the following fields:</p>

<table class="table">
    <thead>
        <tr>
            <th class="unbreakable">Field Name</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>internal name</td>
            <td>The string that precedes the move properties (in this case, "Tackle"). It's the name that the game should use internally to refer to this move, but it's <strong>never</strong> shown in the screen.</td>
        </tr>
        <tr>
            <td>display-name</td>
            <td>The name of the move that is actually shown in the screen.</td>
        </tr>
        <tr>
            <td>type</td>
            <td>
                One of the following:
                <ul>
                    <li>Normal</li>
                    <li>Fighting</li>
                    <li>Flying</li>
                    <li>Poison</li>
                    <li>Ground</li>
                    <li>Rock</li>
                    <li>Bug</li>
                    <li>Ghost</li>
                    <li>Steel</li>
                    <li>Fire</li>
                    <li>Water</li>
                    <li>Grass</li>
                    <li>Electric</li>
                    <li>Psychic</li>
                    <li>Ice</li>
                    <li>Dragon</li>
                    <li>Dark</li>
                    <li>Fairy</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>kind</td>
            <td>
                One of the following:
                <ul>
                    <li>Physical</li>
                    <li>Special</li>
                    <li>Status</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>function-code</td>
            <td>An integer that specifies what this move does. The <a href="#function-code">next section</a> explains it in detail.</td>
        </tr>
        <tr>
            <td>function-parameter</td>
            <td>An integer whose purpose depends on the function-code. See the <a href="#function-code">next section</a> for details.</td>
        </tr>
        <tr>
            <td>power</td>
            <td>The power of the move. It is shown in-game in the move menu of a Pokémon.</td>
        </tr>
        <tr>
            <td>accuracy</td>
            <td>The accuracy of the move, from 0 to 100. The game displays zero accuracy as "-".</td>
        </tr>
        <tr>
            <td>pp</td>
            <td>The maximum PP of this move. Note that PP Ups can increase this value up to 60%.</td>
        </tr>
        <tr id="effect-rate">
            <td>effect-rate</td>
            <td>The chance that the move's additional effect (which depends on the function code) will be applied.</td>
        </tr>
        <tr>
            <td>target-type</td>
            <td>
                One of the following:
                <ul>
                    <li>single-target (e.g Tackle)</li>
                    <li>user (e.g Barrier)</li>
                    <li>no-target (e.g Counter)</li>
                </ul>
                <strong>Note:</strong> more target types will be added when Double Battles are implemented.
            </td>
        </tr>
        <tr>
            <td>priority</td>
            <td>The priority of the move, from -7 to 5.</td>
        </tr>
        <tr>
            <td>flags</td>
            <td>
                A string with a combination of the following:
                <ul>
                    <li>a - the move makes contact</li>
                    <li>b - the move is affected by Protect</li>
                    <li>c - the move is affected by Magic Coat</li>
                    <li>d - the move is affected by Snatch</li>
                    <li>e - the move is affected by Mirror Move</li>
                    <li>f - the move is affected by King's Rock</li>
                    <li>g - thaws out if frozen</li>
                    <li>h - high critical hit rate</li>
                    <li>i - biting move (powered up by Strong Jaw)</li>
                    <li>j - punching move (powered up by Iron Fist)</li>
                    <li>k - sound-based move</li>
                    <li>l - powder-based move (doesn't affect Grass-type Pokémon)</li>
                    <li>m - pulse-based move (powered up by Mega Launcher)</li>
                    <li>n - bomb-based move (resisted by Bulletproof)</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>description</td>
            <td>The description of the move. It is shown in-game.</td>
        </tr>
    </tbody>
</table>

<h3 id="function-code">Function Code</h3>

The following table lists all possible function codes and the purpose of "function-parameter" in each case.

<table class="table">
    <thead>
        <tr>
            <th>Code</th>
            <th>Primary Effect</th>
            <th>Additional Effect*</th>
            <th>function-parameter meaning</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>-13</td>
            <td>damage</td>
            <td>reduce stat, 3 levels</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>-12</td>
            <td>damage</td>
            <td>reduce stat, 2 levels</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>-11</td>
            <td>damage</td>
            <td>reduce stat, 1 level</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>-3</td>
            <td>reduce stat, 3 levels</td>
            <td>-</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>-2</td>
            <td>reduce stat, 2 levels</td>
            <td>-</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>-1</td>
            <td>reduce stat, 1 level</td>
            <td>-</td>
            <td>the reduced stat ID</td>
        </tr>
        <tr>
            <td>0</td>
            <td>damage</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>1</td>
            <td>increase stat, 1 level</td>
            <td>-</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>2</td>
            <td>increase stat, 2 levels</td>
            <td>-</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>3</td>
            <td>increase stat, 3 levels</td>
            <td>-</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>4</td>
            <td>damage</td></td>
            <td>status effect</td>
            <td>the status condition ID</td>
        </tr>
        <tr>
            <td>5</td>
            <td>damage</td>
            <td>flinch</td>
            <td>-</td>
        </tr>
        <tr>
            <td>6</td>
            <td>damage + recoil</td>
            <td>-</td>
            <td>the percentage (1-100) of the damage dealt that is received as recoil damage.</td>
        </tr>
        <tr>
            <td>7</td>
            <td>damage + user faints</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>8</td>
            <td>fixed damage</td>
            <td>-</td>
            <td>the amount of damage dealt</td>
        </tr>
        <tr>
            <td>9</td>
            <td>one-hit KO damage</td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>11</td>
            <td>damage</td>
            <td>increase stat, 1 level</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>12</td>
            <td>damage</td>
            <td>increase stat, 2 levels</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>13</td>
            <td>damage</td>
            <td>increase stat, 3 levels</td>
            <td>the increased stat ID</td>
        </tr>
        <tr>
            <td>99</td>
            <td><a href="#scripting">use script</a></td>
            <td>-</td>
            <td>-</td>
        </tr>
    </tbody>
</table>

<p>* probabilistic, see <a href="#effect-rate">effect-rate</a>.</p>

<p id="stat-id">The <i>stat ID</i> refers to one of these values:</p>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Stat</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>0</td>
            <td>HP</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Attack</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Defense</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Special Attack</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Special Defense</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Speed</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Accuracy</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Evasion</td>
        </tr>
    </tbody>
</table>

<p>Note that HP doesn't have stages and as such <strong>should not be used in the context of stat changing</strong>.</p>

<p id="status-condition-id">The <i>Status Condition ID</i> refers to one of these values:</p>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Status Condition</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>0</td>
            <td>Sleep</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Poison</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Freeze</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Paralysis</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Toxic</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Confusion</td>
        </tr>
    </tbody>
</table>

<h3 id="scripting">Scripting a move</h3>

<p>Most simple moves fit in one of the possible function codes, and thus don't need a script. There are, however, moves that combine several effects or introduce completely new ones, in which case the function code 99 should be used. A move that has function code 99 <strong>does nothing by itself</strong>, it simply tells the game to look for the move's effect somewhere else: the <strong>moves.lua</strong> file.</p>

The moves.lua file contains functions of the form:
<code>function MoveName_eventType
    -- script content here...
end
</code>

For example, a possible implementation of the move Tail Whip is as follows:
<code>function TailWhip_onUse()
    lowerStat(stats.defense, 1)
end
</code>

<p><strong>Note:</strong> Tail Whip is simple enough that the JSON file can fully represent its effect, but it's implemented here as a script for demonstration
purposes.</p>

<p>During battle, the game will call these functions according to the moves used and the current state of the battle. The following events are currently supported:</p>

<table class="table">
    <thead>
        <tr>
            <th>Event</th>
            <th>Description</th>
            <th>Parameters</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>onUse</td>
            <td>Called when the move is used.</td>
            <td>-</td>
        </tr>
        <tr>
            <td>onDamageReceived</td>
            <td>Called when the user receives damage while the move is in effect.</td>
            <td>
                <strong>damage</strong> (int) - the damage received
            </td>
        </tr>
        <tr>
            <td>onTurnStart</td>
            <td>Called at the start of the turn that the move is used or is in effect.</td>
            <td>-</td>
        </tr>
        <tr>
            <td>onTurnEnd</td>
            <td>Called at the end of the turn that the move is used or is in effect.</td>
            <td>-</td>
        </tr>
    </tbody>
</table>

The functions that are available inside the script's function body are:

<table class="table">
    <thead>
        <tr>
            <th>Function Signature</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>void damage()</td>
            <td>Deals damage to the target according to the <a href="#move-fields">move properties</a>.</td>
        </tr>
        <tr>
            <td>void damageWithFixedRecoil(int lostHP)</td>
            <td>Calls <code class="inline">damage()</code> and, if it hits, deals exactly <code class="inline">lostHP</code> recoil damage to the user.</td>
        </tr>
        <tr>
            <td>void damageWithRecoil(float recoilRate)</td>
            <td>Calls <code class="inline">damage()</code> and, if it hits, deals <code class="inline">"damage dealt" * recoilRate</code> recoil damage to the user.</td>
        </tr>
        <tr>
            <td>void fixedDamage(int lostHP)</td>
            <td>Equivalent to <code class="inline">damage()</code> except that, if it hits, exactly <code class="inline">lostHP</code> damage is dealt. No critical hit check is performed and type effectiveness is not considered except for type immunity.</td>
        </tr>
        <tr>
            <td>void lowerStat(int <a href="#stat-id">statID</a>, int levels)</td>
            <td>Reduces the corresponding stat stages of the target by the specified number of levels.</td>
        </tr>
        <tr>
            <td>void raiseStat(int <a href="#stat-id">statID</a>, int levels)</td>
            <td>Raises the corresponding stat stages of the target by the specified number of levels.</td>
        </tr>
        <tr>
            <td>void ensureCriticalHit()</td>
            <td>Guarantees a critical hit on the next call to <code class="inline">damage()</code>.</td>
        </tr>
        <tr>
            <td>void showText(string content)</td>
            <td>Displays the specified text.</td>
        </tr>
    </tbody>
</table>

Additionally, the following variables are available as well:

<table class="table">
    <thead>
        <tr>
            <th>Variable</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>string user.species</td>
            <td>The internal name of the user's species.</td>
        </tr>
        <tr>
            <td>int user.nature</td>
            <td>
                The nature ID of the user:
                <ul>
                    <li>0 - Hardy</li>
                    <li>1 - Lonely</li>
                    <li>2 - Adamant</li>
                    <li>3 - Naughty</li>
                    <li>4 - Brave</li>
                    <li>5 - Bold</li>
                    <li>6 - Docile</li>
                    <li>7 - Impish</li>
                    <li>8 - Lax</li>
                    <li>9 - Relaxed</li>
                    <li>10 - Modest</li>
                    <li>11 - Mild</li>
                    <li>12 - Bashful</li>
                    <li>13 - Rash</li>
                    <li>14 - Quiet</li>
                    <li>15 - Calm</li>
                    <li>16 - Gentle</li>
                    <li>17 - Careful</li>
                    <li>18 - Quirky</li>
                    <li>19 - Sassy</li>
                    <li>20 - Timid</li>
                    <li>21 - Hasty</li>
                    <li>22 - Jolly</li>
                    <li>23 - Naive</li>
                    <li>24 - Serious</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>string user.heldItem</td>
            <td>The internal name of the user's held item.</td>
        </tr>
        <tr>
            <td>string user.ability</td>
            <td>The internal name of the user's ability.</td>
        </tr>
        <tr>
            <td>int user.moveCount</td>
            <td>The number of moves the user has.</td>
        </tr>
        <tr>
            <td>
                string user.move0<br>
                string user.move1<br>
                string user.move2<br>
                string user.move3
            </td>
            <td>The internal names of the user's moves.</td>
        </tr>
        <tr>
            <td>
                int user.pp0<br>
                int user.pp1<br>
                int user.pp2<br>
                int user.pp3
            </td>
            <td>The current PP values of the user.</td>
        </tr>
        <tr>
            <td>int user.gender</td>
            <td>
                The gender ID of the user:
                <ul>
                    <li>0 - Male</li>
                    <li>1 - Female</li>
                    <li>2 - Genderless</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>int user.form</td>
            <td>The form ID of the user.</td>
        </tr>
        <tr>
            <td>string user.displayName</td>
            <td>The display name of the user.</td>
        </tr>
        <tr>
            <td>int user.status</td>
            <td>
                The current status condition of the user:
                <ul>
                    <li>0 - Normal</li>
                    <li>1 - Sleep</li>
                    <li>2 - Poison</li>
                    <li>3 - Freeze</li>
                    <li>4 - Paralysis</li>
                    <li>5 - Toxic</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>int user.asleepRounds</td>
            <td>The number of turns the user will stay asleep (0 if it's not sleeping).</td>
        </tr>
        <tr>
            <td>int user.level</td>
            <td>The level of the user.</td>
        </tr>
        <tr>
            <td>
                int user.hp<br>
                int user.attack<br>
                int user.defense<br>
                int user.specialAttack<br>
                int user.specialDefense<br>
                int user.speed
            </td>
            <td>The current stats of the user (user.hp corresponds to its maximum HP).</td>
        </tr>
        <tr>
            <td>int user.currentHP</td>
            <td>The current HP of the user.</td>
        </tr>
    </tbody>
</table>

<strong>Note:</strong> the same fields are available for the <code class="inline">target</code> variable, which contains information about the target of the move.
